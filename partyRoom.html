<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="css/bootstrap.css">
	<script src="js/jquery-2.1.3.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/custom.js"></script>
  <link rel="stylesheet" type="text/css" href="css/jquery.countdown.css"> 
  <script type="text/javascript" src="js/jquery.plugin.min.js"></script> 
  <script type="text/javascript" src="js/jquery.countdown.js"></script>
  <style type="text/css">
  .time{
    font-size: 12px;
    border:0;
  }
  </style>
  <script type="text/javascript">
    var pid;
    var owner;
    function getUrlParameter(sParam)
    {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) 
      {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
          return sParameterName[1];
        }
      }
    }  

    function init(){
      pid=getUrlParameter('pid');
      console.log(pid);
      getPartyDetails(pid);
      getPartyMember(pid);
    }
    function getPartyMember(pid){
      xmlhttp1=new XMLHttpRequest();
      xmlhttp1.onreadystatechange=function()
      {
        if (xmlhttp1.readyState==4 && xmlhttp1.status==200)
        {
          text=xmlhttp1.responseText;
          var current=0;
          $("tbody").html("");
          var partyMember = JSON.parse(text);
          for (i=0;i<partyMember.length;i++){
            $("tbody").append('<tr><td>'+partyMember[i].uname+'</td><td>'+partyMember[i].food+'</td><td>'+partyMember[i].amount+'</td><td><button class="btn btn-danger">Cancel</button></td></tr>');
            current=parseFloat(current)+parseFloat(partyMember[i].amount);
          }
          $('#current').text("current: "+current);
        }
      }
      xmlhttp1.open("GET","getPartyMember.php?pid="+pid,true);
      xmlhttp1.send();
    }


    function getPartyDetails(pid){
      xmlhttp=new XMLHttpRequest();
      xmlhttp.onreadystatechange=function()
      {
        if (xmlhttp.readyState==4 && xmlhttp.status==200)
        {
          text=xmlhttp.responseText;
          var partyDetails = JSON.parse(text);
          $('#time').html('Time: <span class="time">'+partyDetails[0].time+'</span>');
          $('#res').text('Restaurant: '+partyDetails[0].res);
          $('#goal').text('Goal: '+partyDetails[0].target);
          owner = partyDetails[0].ownerId;
          playTime();
        }
      }
      xmlhttp.open("GET","getPartyDetails.php?pid="+pid,true);
      xmlhttp.send();
    }

    function newFoodRequest(pid){
      xmlhttp2=new XMLHttpRequest();
      xmlhttp2.onreadystatechange=function()
      {
        if (xmlhttp2.readyState==4 && xmlhttp2.status==200)
        {
          getPartyMember(pid);
        }
      }
      food=$('#inputFood').val();
      amount=$('#inputMoney').val();
      sid="13456789d";
      url="newfoodRequest.php?pid="+pid+"&food="+food+"&amount="+amount+"&sid="+sid;
      xmlhttp2.open("GET",url,true);
      xmlhttp2.send();
    
    }
  </script>
</head>
<body onload=init()>
	<div class="container">
    <div class="row">
      <div class="jumbotron">
       <h1>Party Room</h1>
       <p id="time"></p>
       <p id="res"></p>
       <p id="goal"></p>
       <p id="current"></p>
     </div>
     <div class="form-inline">
      <div class="form-group">
        <label for="inputFood">Food</label>
        <input type="text" class="form-control" id="inputFood" placeholder="set meal 1">
      </div>
      <div class="form-group">
        <label for="inputMoney">Amount</label>
        $<input type="text" class="form-control" id="inputMoney" placeholder="50">
      </div>
      <button onclick=newFoodRequest(pid) href=# class="btn btn-primary">Add</button>
    </form>
    <table class="table">
     <thead><tr><th>Name</th><th>Food</th><th>Amount</th><th></th></tr></thead>
     <tbody>
       <tr><td>Ben</td><td>set meal 1</td><td>20</td><td><button class="btn btn-danger" type="submit">Cancel</button></td></tr>
     </tbody>
   </table>
 </div>
</div>
</body>
</html>